# Schedule Service - Visual Architecture

## ??? System Architecture

```
???????????????????????????????????????????????????????????????
?                    PRESENTATION LAYER                        ?
?                  (Razor Pages / Controllers)                 ?
?                                                              ?
?  ????????????  ????????????  ????????????  ????????????  ?
?  ?  Index   ?  ?  Create  ?  ?   Edit   ?  ?  Delete  ?  ?
?  ?  .cshtml ?  ?  .cshtml ?  ?  .cshtml ?  ?  .cshtml ?  ?
?  ????????????  ????????????  ????????????  ????????????  ?
?       ?             ?              ?              ?         ?
???????????????????????????????????????????????????????????????
        ?             ?              ?              ?
        ?????????????????????????????????????????????
                            ?
                            ?
???????????????????????????????????????????????????????????????
?                      SERVICE LAYER                           ?
?                   (Business Logic)                           ?
?                                                              ?
?  ????????????????????????????????????????????????????????  ?
?  ?           IScheduleService Interface                  ?  ?
?  ????????????????????????????????????????????????????????  ?
?  ?  • CreateScheduleAsync()                             ?  ?
?  ?  • GetScheduleByIdAsync()                            ?  ?
?  ?  • GetSchedulesByRoomAsync()                         ?  ?
?  ?  • UpdateScheduleAsync()                             ?  ?
?  ?  • DeleteScheduleAsync()                             ?  ?
?  ?  • HasScheduleConflictAsync()     ? Conflict Check  ?  ?
?  ?  • IsTimeSlotAvailableAsync()     ? Break Time Check?  ?
?  ?  • GetConflictingSchedulesAsync()                    ?  ?
?  ????????????????????????????????????????????????????????  ?
?                            ?                                 ?
?                            ?                                 ?
?  ????????????????????????????????????????????????????????  ?
?  ?          ScheduleService Implementation               ?  ?
?  ?  (Contains all business logic & validation)          ?  ?
?  ????????????????????????????????????????????????????????  ?
???????????????????????????????????????????????????????????????
                            ?
                            ?
???????????????????????????????????????????????????????????????
?                   REPOSITORY LAYER                           ?
?                   (Data Access)                              ?
?                                                              ?
?  ????????????????????????????????????????????????????????  ?
?  ?              IUnitOfWork Interface                    ?  ?
?  ????????????????????????????????????????????????????????  ?
?  ?  • Schedule Repository                                ?  ?
?  ?  • Room Repository                                    ?  ?
?  ?  • Campus Repository                                  ?  ?
?  ?  • User Repository                                    ?  ?
?  ?  • SaveChangesAsync()                                 ?  ?
?  ????????????????????????????????????????????????????????  ?
?                            ?                                 ?
?                            ?                                 ?
?  ????????????????????????????????????????????????????????  ?
?  ?      IGenericRepository<Schedule>                     ?  ?
?  ?  (CRUD operations for Schedule entity)               ?  ?
?  ????????????????????????????????????????????????????????  ?
???????????????????????????????????????????????????????????????
                            ?
                            ?
???????????????????????????????????????????????????????????????
?                     DATABASE LAYER                           ?
?                    (PostgreSQL)                              ?
?                                                              ?
?  ????????????????????????????????????????????????????????  ?
?  ?             Schedules Table                           ?  ?
?  ????????????????????????????????????????????????????????  ?
?  ?  Id (UUID, PK)                                        ?  ?
?  ?  RoomId (UUID, FK ? Rooms)                           ?  ?
?  ?  ScheduleType (TEXT)                                  ?  ?
?  ?  Title (TEXT)                                         ?  ?
?  ?  StartTime (INTERVAL)                                 ?  ?
?  ?  EndTime (INTERVAL)                                   ?  ?
?  ?  DayOfWeek (INTEGER: 0-6)                            ?  ?
?  ?  StartDate (TIMESTAMP)                                ?  ?
?  ?  EndDate (TIMESTAMP)                                  ?  ?
?  ?  IsDeleted, CreatedAt, CreatedBy, etc.               ?  ?
?  ????????????????????????????????????????????????????????  ?
???????????????????????????????????????????????????????????????
```

## ?? Conflict Detection Flow

```
User Creates Schedule
        ?
        ?
?????????????????????????
? Validate Input Data   ?
? • StartTime < EndTime ?
? • StartDate < EndDate ?
? • Room exists?        ?
?????????????????????????
        ?
        ?
??????????????????????????????????????????????????
? Query Existing Schedules                       ?
? WHERE:                                         ?
?  • Same RoomId                                 ?
?  • Same DayOfWeek                              ?
?  • Date ranges overlap                         ?
?  • NOT deleted                                 ?
??????????????????????????????????????????????????
         ?
         ?
??????????????????????????????????????????????????
? For Each Existing Schedule:                    ?
?                                                ?
?  ???????????????????????????????????????????? ?
?  ? Add Break Time Buffer:                   ? ?
?  ?                                          ? ?
?  ?  Existing: 09:00 ??????? 11:00          ? ?
?  ?            ?              ?              ? ?
?  ?  Extended: 08:45 ??????? 11:15          ? ?
?  ?           (?15min)      (+15min)        ? ?
?  ???????????????????????????????????????????? ?
?                                                ?
?  ???????????????????????????????????????????? ?
?  ? Check Overlap:                           ? ?
?  ?                                          ? ?
?  ?  New Schedule: 10:00 ??? 12:00          ? ?
?  ?                   ?                      ? ?
?  ?  Extended Existing: 08:45 ??????? 11:15 ? ?
?  ?                                          ? ?
?  ?  OVERLAP DETECTED! ?                    ? ?
?  ???????????????????????????????????????????? ?
??????????????????????????????????????????????????
         ?
         ???? No Conflict ??? ? CREATE Schedule
         ?
         ???? Has Conflict ??? ? REJECT with details
                                   "Conflicts with: Math (09:00-11:00)"
```

## ?? Schedule Timeline Example

```
Monday Schedule for Room 101:

Time        Schedule                           Status
?????????????????????????????????????????????????????????????
07:00   ?                                    ?
        ?  ???????????????????????????????  ?
07:30   ?  ? Programming - PRN222        ?  ? ? OK
        ?  ? (Academic Course)           ?  ?
09:30   ?  ???????????????????????????????  ?
        ?           ? Break: 15 min         ?
09:45   ?  ?????????????????????????????    ?
        ?                                    ?
10:00   ?  ???????????????????????????????  ?
        ?  ? Database - DBI202           ?  ? ? OK
        ?  ? (Academic Course)           ?  ?
12:00   ?  ???????????????????????????????  ?
        ?           ? Break: 15 min         ?
12:15   ?  ?????????????????????????????    ?
        ?                                    ?
13:00   ?  ???????????????????????????????  ?
        ?  ? Web Development - PRN211    ?  ? ? OK
        ?  ? (Academic Course)           ?  ?
15:00   ?  ???????????????????????????????  ?
        ?                                    ?
        ?  ?? Attempt to add:               ?
14:45   ?  ???????????????????????????????  ?
        ?  ? New Course                  ?  ? ? CONFLICT!
16:45   ?  ???????????????????????????????  ? (No 15-min break)
        ?                                    ?
18:00   ?  ???????????????????????????????  ?
        ?  ? Lab Maintenance             ?  ? ? OK
        ?  ? (Recurring Maintenance)     ?  ?
20:00   ?  ???????????????????????????????  ?
```

## ?? Key Validation Rules

```
??????????????????????????????????????????????????????????
?               VALIDATION CHECKLIST                      ?
??????????????????????????????????????????????????????????
?                                                        ?
?  ? Time Validation                                    ?
?    ?? StartTime < EndTime                             ?
?                                                        ?
?  ? Date Validation                                    ?
?    ?? StartDate < EndDate                             ?
?                                                        ?
?  ? Day of Week                                        ?
?    ?? 0 (Sunday) to 6 (Saturday)                      ?
?                                                        ?
?  ? Room Exists                                        ?
?    ?? Room must exist and not be deleted              ?
?                                                        ?
?  ? No Time Overlap                                    ?
?    ?? Check against existing schedules same day       ?
?                                                        ?
?  ? Break Time                                         ?
?    ?? Minimum gap between consecutive schedules       ?
?       (Default: 15 minutes, Configurable)             ?
?                                                        ?
?  ? Date Range Overlap                                 ?
?    ?? Only check conflicts with overlapping dates     ?
?                                                        ?
??????????????????????????????????????????????????????????
```

## ?? DTO Flow

```
Create Schedule Flow:
????????????????????????????????????????????????????????

User Input (Form/API)
        ?
        ?
????????????????????????????????????????????????
?         CreateScheduleDto                     ?
????????????????????????????????????????????????
?  • RoomId: Guid                               ?
?  • ScheduleType: Enum                         ?
?  • Title: string                              ?
?  • StartTime: TimeSpan                        ?
?  • EndTime: TimeSpan                          ?
?  • DayOfWeek: int (0-6)                       ?
?  • StartDate: DateTime                        ?
?  • EndDate: DateTime                          ?
?  • BreakTimeMinutes: int (default 15)        ?
????????????????????????????????????????????????
            ?
            ?
    ScheduleService.CreateScheduleAsync()
            ?
            ??? Validation
            ??? Conflict Check
            ??? Break Time Check
            ?
            ?
????????????????????????????????????????????????
?         Schedule Entity                       ?
????????????????????????????????????????????????
?  + BaseEntity fields (Id, IsDeleted, etc.)   ?
?  + Audit fields (CreatedAt, CreatedBy)       ?
????????????????????????????????????????????????
            ?
            ?
        Database Save
            ?
            ?
????????????????????????????????????????????????
?         ScheduleDto (Response)                ?
????????????????????????????????????????????????
?  + All Schedule data                          ?
?  + RoomName, CampusName (from join)          ?
?  + Display values (TypeDisplay, DayDisplay)  ?
????????????????????????????????????????????????
            ?
            ?
    Return to User
```

## ?? Security & Audit

```
Every Schedule Operation Tracks:
???????????????????????????????????????????????

???????????????????????????????????????????????
?            Audit Information                 ?
???????????????????????????????????????????????
?                                             ?
?  Created:                                   ?
?    • CreatedAt: When?                       ?
?    • CreatedBy: Who? (User ID from JWT)    ?
?                                             ?
?  Updated:                                   ?
?    • UpdatedAt: When?                       ?
?    • UpdatedBy: Who?                        ?
?                                             ?
?  Deleted:                                   ?
?    • DeletedAt: When?                       ?
?    • DeletedBy: Who?                        ?
?    • IsDeleted: true (Soft Delete)         ?
?                                             ?
???????????????????????????????????????????????

JWT Token ? ClaimsService ? GetCurrentUserId
                  ?
            Automatically added to all operations
```

## ?? Performance Considerations

```
Database Indexes (Recommended):
???????????????????????????????????????????????

CREATE INDEX idx_schedules_room_day 
    ON Schedules(RoomId, DayOfWeek) 
    WHERE IsDeleted = FALSE;

CREATE INDEX idx_schedules_daterange 
    ON Schedules(StartDate, EndDate) 
    WHERE IsDeleted = FALSE;

CREATE INDEX idx_schedules_composite 
    ON Schedules(RoomId, DayOfWeek, StartDate, EndDate) 
    WHERE IsDeleted = FALSE;

Impact:
  • Faster conflict detection queries
  • Improved schedule lookup performance
  • Efficient filtering by date range
```

## ?? Usage Statistics

```
Service Provides Data For:
???????????????????????????????????????????????

Admin Dashboard:
  • Total schedules per room
  • Most utilized rooms
  • Schedule distribution by type
  • Time slot popularity

Reports:
  • Room utilization rate
  • Peak usage hours
  • Schedule conflicts history
  • Maintenance schedule tracking

Calendar View:
  • Weekly schedule grid
  • Monthly overview
  • Day-by-day breakdown
  • Conflict highlights
```

This visual guide should help you understand the complete architecture and flow of the Schedule Service!
